[2025-05-18T20:11:58.397+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: telegram_summary_channel_1137503644.parse_channel_posts manual__2025-05-18T20:11:56.522747+00:00 [queued]>
[2025-05-18T20:11:58.406+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: telegram_summary_channel_1137503644.parse_channel_posts manual__2025-05-18T20:11:56.522747+00:00 [queued]>
[2025-05-18T20:11:58.407+0000] {taskinstance.py:2170} INFO - Starting attempt 1 of 2
[2025-05-18T20:11:58.428+0000] {taskinstance.py:2191} INFO - Executing <Task(DockerOperator): parse_channel_posts> on 2025-05-18 20:11:56.522747+00:00
[2025-05-18T20:11:58.435+0000] {standard_task_runner.py:60} INFO - Started process 204 to run task
[2025-05-18T20:11:58.444+0000] {standard_task_runner.py:87} INFO - Running: ['airflow', 'tasks', 'run', 'telegram_summary_channel_1137503644', 'parse_channel_posts', 'manual__2025-05-18T20:11:56.522747+00:00', '--job-id', '56', '--raw', '--subdir', 'DAGS_FOLDER/dag_generator.py', '--cfg-path', '/tmp/tmpmrcjhhl4']
[2025-05-18T20:11:58.447+0000] {standard_task_runner.py:88} INFO - Job 56: Subtask parse_channel_posts
[2025-05-18T20:11:58.517+0000] {task_command.py:423} INFO - Running <TaskInstance: telegram_summary_channel_1137503644.parse_channel_posts manual__2025-05-18T20:11:56.522747+00:00 [running]> on host e5cd1b16e7bb
[2025-05-18T20:11:58.599+0000] {taskinstance.py:2480} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='airflow' AIRFLOW_CTX_DAG_ID='telegram_summary_channel_1137503644' AIRFLOW_CTX_TASK_ID='parse_channel_posts' AIRFLOW_CTX_EXECUTION_DATE='2025-05-18T20:11:56.522747+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-05-18T20:11:56.522747+00:00'
[2025-05-18T20:11:58.704+0000] {docker.py:359} INFO - Starting docker container from image telegram_parser_task:latest
[2025-05-18T20:11:59.517+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [INFO] [Parser] - Запуск основного асинхронного процесса парсера (локальный или прямой вызов)...
[2025-05-18T20:11:59.517+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Using selector: EpollSelector
[2025-05-18T20:11:59.518+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [INFO] [Parser] - --- Запуск скрипта парсера (Airflow Task) ---
[2025-05-18 20:11:59] [INFO] [Parser] - Целевой канал (идентификатор для Telethon): https://t.me/trader_chernyh
[2025-05-18 20:11:59] [INFO] [Parser] - Числовой ID канала (из конфига DAG): 1137503644
[2025-05-18 20:11:59] [INFO] [Parser] - Целевая дата парсинга: 2025-05-18
[2025-05-18 20:11:59] [INFO] [Parser] - Попытка подключения к БД (1/5): host=postgres_results_db_service port=5432 dbname=parsing_results user=parser_user
[2025-05-18T20:11:59.526+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [INFO] [Parser] - Успешное подключение к БД!
[2025-05-18 20:11:59] [INFO] [Parser] - Проверка/создание таблицы 'telegram_messages'...
[2025-05-18T20:11:59.535+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [INFO] [Parser] - Схема БД 'telegram_messages' проверена/обновлена.
[2025-05-18 20:11:59] [INFO] [Parser] - Инициализация Telegram клиента с сессией: /app/session/my_telegram_session
[2025-05-18 20:11:59] [INFO] [Parser] - Файл сессии '/app/session/my_telegram_session.session' существует: True
[2025-05-18T20:11:59.536+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [INFO] [Parser] - Подключение к Telegram...
[2025-05-18T20:11:59.536+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [INFO] [Parser] - Connecting to 149.154.167.51:443/TcpFull...
[2025-05-18 20:11:59] [DEBUG] [Parser] - Connection attempt 1...
[2025-05-18T20:11:59.662+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Connection success!
[2025-05-18 20:11:59] [DEBUG] [Parser] - Starting send loop
[2025-05-18 20:11:59] [DEBUG] [Parser] - Starting receive loop
[2025-05-18T20:11:59.663+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [INFO] [Parser] - Connection to 149.154.167.51:443/TcpFull complete!
[2025-05-18T20:11:59.680+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18 20:11:59] [DEBUG] [Parser] - Assigned msg_id = 7505881065339666456 to InvokeWithLayerRequest (ff270ae46220)
[2025-05-18T20:11:59.680+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypting 1 message(s) in 80 bytes for sending
[2025-05-18T20:11:59.681+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18 20:11:59] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18 20:11:59] [DEBUG] [Parser] - Receiving items from the network...
[2025-05-18T20:11:59.770+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Handling bad salt for message 7505881065339666456
[2025-05-18 20:11:59] [DEBUG] [Parser] - 1 message(s) will be resent
[2025-05-18 20:11:59] [DEBUG] [Parser] - Receiving items from the network...
[2025-05-18T20:11:59.771+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Assigned msg_id = 7505881065700622648 to InvokeWithLayerRequest (ff270ae46220)
[2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypting 1 message(s) in 80 bytes for sending
[2025-05-18T20:11:59.772+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18 20:11:59] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18 20:11:59] [DEBUG] [Parser] - Assigned msg_id = 7505881065703319640 to MsgsAck (ff270ae46340)
[2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypting 1 message(s) in 36 bytes for sending
[2025-05-18T20:11:59.773+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18 20:11:59] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18T20:11:59.865+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Handling container
[2025-05-18 20:11:59] [DEBUG] [Parser] - Handling new session created
[2025-05-18 20:11:59] [DEBUG] [Parser] - Handling acknowledge for [7505881065700622648]
[2025-05-18T20:11:59.867+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Receiving items from the network...
[2025-05-18T20:11:59.867+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Handling RPC result for message 7505881065700622648
[2025-05-18T20:11:59.872+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Receiving items from the network...
[2025-05-18T20:11:59.880+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Assigned msg_id = 7505881066133755772 to GetUsersRequest (ff270ae46e80)
[2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypting 1 message(s) in 32 bytes for sending
[2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18T20:11:59.881+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18 20:11:59] [DEBUG] [Parser] - Assigned msg_id = 7505881066137209028 to MsgsAck (ff270ae462b0)
[2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypting 1 message(s) in 60 bytes for sending
[2025-05-18T20:11:59.881+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18 20:11:59] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18T20:11:59.966+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Handling RPC result for message 7505881066133755772
[2025-05-18 20:11:59] [DEBUG] [Parser] - Receiving items from the network...
[2025-05-18T20:11:59.968+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Assigned msg_id = 7505881066486801236 to GetStateRequest (ff270ae46e80)
[2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypting 1 message(s) in 20 bytes for sending
[2025-05-18T20:11:59.968+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18 20:11:59] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18T20:11:59.969+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Assigned msg_id = 7505881066490096180 to MsgsAck (ff270ae46910)
[2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypting 1 message(s) in 36 bytes for sending
[2025-05-18T20:11:59.974+0000] {docker.py:429} INFO - [2025-05-18 20:11:59] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18 20:11:59] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18T20:12:00.086+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Handling RPC result for message 7505881066486801236
[2025-05-18 20:12:00] [DEBUG] [Parser] - Receiving items from the network...
[2025-05-18 20:12:00] [DEBUG] [Parser] - Assigned msg_id = 7505881067257067416 to GetDifferenceRequest (ff270be1ad00)
[2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypting 1 message(s) in 36 bytes for sending
[2025-05-18T20:12:00.087+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18 20:12:00] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18 20:12:00] [DEBUG] [Parser] - Assigned msg_id = 7505881067259136888 to MsgsAck (ff270ae46d30)
[2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypting 1 message(s) in 36 bytes for sending
[2025-05-18T20:12:00.087+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18T20:12:00.087+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18T20:12:00.180+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Handling RPC result for message 7505881067257067416
[2025-05-18 20:12:00] [DEBUG] [Parser] - Receiving items from the network...
[2025-05-18T20:12:00.182+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Assigned msg_id = 7505881067633520816 to GetUsersRequest (ff270ae46700)
[2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypting 1 message(s) in 32 bytes for sending
[2025-05-18T20:12:00.182+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18 20:12:00] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18 20:12:00] [DEBUG] [Parser] - Assigned msg_id = 7505881067638159488 to MsgsAck (ff270ae46e20)
[2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypting 1 message(s) in 36 bytes for sending
[2025-05-18T20:12:00.182+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18 20:12:00] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18T20:12:00.274+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Handling RPC result for message 7505881067633520816
[2025-05-18 20:12:00] [DEBUG] [Parser] - Receiving items from the network...
[2025-05-18T20:12:00.275+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [INFO] [Parser] - Успешно подключен к Telegram как Ильяс (ID: 1257870016).
[2025-05-18 20:12:00] [INFO] [Parser] - Начало парсинга канала 'https://t.me/trader_chernyh' за дату 2025-05-18
[2025-05-18 20:12:00] [INFO] [Parser] - Получение информации о канале 'https://t.me/trader_chernyh'...
[2025-05-18T20:12:00.275+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Assigned msg_id = 7505881068011215900 to ResolveUsernameRequest (ff270aed63a0)
[2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypting 1 message(s) in 40 bytes for sending
[2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18T20:12:00.276+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18 20:12:00] [DEBUG] [Parser] - Assigned msg_id = 7505881068014086456 to MsgsAck (ff270ae46250)
[2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypting 1 message(s) in 36 bytes for sending
[2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18 20:12:00] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18T20:12:00.369+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Handling RPC result for message 7505881068011215900
[2025-05-18 20:12:00] [DEBUG] [Parser] - Receiving items from the network...
[2025-05-18T20:12:00.370+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [INFO] [Parser] - Канал найден: 'Евгений Черных и 401🍋' (ID: 1137503644)
[2025-05-18 20:12:00] [INFO] [Parser] - Итерация сообщений с offset_date=2025-05-19T00:00:00+00:00 (поиск сообщений ДО этой даты)...
[2025-05-18T20:12:00.371+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Assigned msg_id = 7505881068394124720 to GetHistoryRequest (ff270aed6340)
[2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypting 1 message(s) in 72 bytes for sending
[2025-05-18T20:12:00.372+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18 20:12:00] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18 20:12:00] [DEBUG] [Parser] - Assigned msg_id = 7505881068396875116 to MsgsAck (ff270aed63a0)
[2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypting 1 message(s) in 36 bytes for sending
[2025-05-18 20:12:00] [DEBUG] [Parser] - Encrypted messages put in a queue to be sent
[2025-05-18 20:12:00] [DEBUG] [Parser] - Waiting for messages to send...
[2025-05-18T20:12:00.851+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Handling RPC result for message 7505881068394124720
[2025-05-18T20:12:00.894+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Receiving items from the network...
[2025-05-18T20:12:00.900+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [INFO] [Parser] - Достигнуто начало дня 2025-05-18 (сообщение от 2025-05-17 17:37:04+00:00). Завершение итерации.
[2025-05-18 20:12:00] [INFO] [Parser] - Парсинг за 2025-05-18 завершен. Получено сообщений: 2
[2025-05-18 20:12:00] [INFO] [Parser] - Список сообщений развернут (от старых к новым).
[2025-05-18T20:12:00.900+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [INFO] [Parser] - Успешно получено 2 сообщений из Telegram.
[2025-05-18 20:12:00] [INFO] [Parser] - Начало сохранения 2 сообщений в БД...
[2025-05-18 20:12:00] [WARNING] [Parser] - Не удалось декодировать bytes как UTF-8, будет использовано base64 или плейсхолдер.
[2025-05-18 20:12:00] [WARNING] [Parser] - Не удалось декодировать bytes как UTF-8, будет использовано base64 или плейсхолдер.
[2025-05-18T20:12:00.902+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Данные для вставки (ID: 9668): {'message_id': 9668, 'channel_id': 1137503644, 'message_date': datetime.datetime(2025, 5, 18, 9, 30, 40, tzinfo=datetime.timezone.utc), 'text': '**Ну что, коллеги, котлету зажарили? ****😁****\n**\nПомните, как на прошлой неделе говорил: **уровень 2780 по индексу надо выкупать?**\n\n✅ Уровень устоял. Кто успел — красавчик. \n\n**Можете смело брать с полки пирожок. С вареньем, не с капустой.\n**\nНО! Мы отскочили. И я уже вижу зону, где могут начать падать акции.\n\nВ новом ролике рассказал об этом 👇\n\n[**➡️ Ютуб**](https://youtu.be/5AwSbmokQz8)\n\n[**➡️ Рутуб**](https://rutube.ru/video/5ee7f6f9a8012d868d2e43ecf69c6ba2/)\n\n[**➡️ ВК.видео**](https://vk.com/trader_chernyh?z=video-98605354_456239285%2F2864508e17832f796a%2Fpl_wall_314989763)', 'sender_id': -1001137503644, 'views': 22513, 'forwards': 37, 'is_reply': False, 'reply_to_msg_id': None, 'has_media': True, 'raw_data': {'_': 'Message', 'id': 9668, 'peer_id': {'_': 'PeerChannel', 'channel_id': 1137503644}, 'date': datetime.datetime(2025, 5, 18, 9, 30, 40, tzinfo=datetime.timezone.utc), 'message': 'Ну что, коллеги, котлету зажарили? 😁\n\nПомните, как на прошлой неделе говорил: уровень 2780 по индексу надо выкупать?\n\n✅ Уровень устоял. Кто успел — красавчик. \n\nМожете смело брать с полки пирожок. С вареньем, не с капустой.\n\nНО! Мы отскочили. И я уже вижу зону, где могут начать падать акции.\n\nВ новом ролике рассказал об этом 👇\n\n➡️ Ютуб\n\n➡️ Рутуб\n\n➡️ ВК.видео', 'out': False, 'mentioned': False, 'media_unread': False, 'silent': False, 'post': True, 'from_scheduled': False, 'legacy': False, 'edit_hide': False, 'pinned': False, 'noforwards': False, 'invert_media': False, 'offline': False, 'video_processing_pending': False, 'from_id': None, 'from_boosts_applied': None, 'saved_peer_id': None, 'fwd_from': None, 'via_bot_id': None, 'via_business_bot_id': None, 'reply_to': None, 'media': {'_': 'MessageMediaPhoto', 'spoiler': False, 'photo': {'_': 'Photo', 'id': 5280882906178383680, 'access_hash': -3981731074258897901, 'file_reference': b'\x02C\xcc\xed\x9c\x00\x00%\xc4h*?\x10\xfd\xebX\xb4\x90=\x9d\x01/\xcb\xe6g&\x94\x8a\xd1', 'date': datetime.datetime(2025, 5, 18, 9, 18, 14, tzinfo=datetime.timezone.utc), 'sizes': [{'_': 'PhotoStrippedSize', 'type': 'i', 'bytes': b'\x01\x17(\xa4m\xd4F[vy\x1d\rL\xd61\x88\xd9\xd5\xc3\x03\x82\xa0\x1ei\xe9\x1c\x8e\x87\x07r\x8eA\x00\x01\x9a\x9dw\xbd\xb3.0\xdfO\xc7\x14\xde\xe2\x8b\xbal\x86\x18\xed\xc4@:s\xd8\x91R\x18,\xfb\xae?:\xab\xe6H\xab\x86?\x87\xa5\r+\xf9\x8c\xbb\xc3m\xe8@\xebWdey\x0b=\xbc\n\x8eW9\xc0\xc63\x81\xcf4S\'\x99\x82\x80X\x1c\xf5\xa2\x93\xb0\xd3\x93%[\xfc\x0cb\x9d\xf6\xefj(\xa84"\xb9\xb9Yb9^{\x1a\xa2\x0e\x0eh\xa2\x98\x03\x1c\x9c\xd1E\x14\x01'}, {'_': 'PhotoSize', 'type': 'm', 'w': 320, 'h': 180, 'size': 19745}, {'_': 'PhotoSize', 'type': 'x', 'w': 800, 'h': 450, 'size': 79973}, {'_': 'PhotoSizeProgressive', 'type': 'y', 'w': 1280, 'h': 720, 'sizes': [12859, 30871, 42454, 62686, 108779]}], 'dc_id': 2, 'has_stickers': False, 'video_sizes': []}, 'ttl_seconds': None}, 'reply_markup': None, 'entities': [{'_': 'MessageEntityBold', 'offset': 0, 'length': 35}, {'_': 'MessageEntityBold', 'offset': 35, 'length': 2}, {'_': 'MessageEntityCustomEmoji', 'offset': 35, 'length': 2, 'document_id': 5375139605165119881}, {'_': 'MessageEntityBold', 'offset': 37, 'length': 1}, {'_': 'MessageEntityBold', 'offset': 79, 'length': 38}, {'_': 'MessageEntityUnderline', 'offset': 79, 'length': 38}, {'_': 'MessageEntityCustomEmoji', 'offset': 119, 'length': 1, 'document_id': 5411197345968701560}, {'_': 'MessageEntityBold', 'offset': 162, 'length': 63}, {'_': 'MessageEntityCustomEmoji', 'offset': 328, 'length': 2, 'document_id': 5231102735817918643}, {'_': 'MessageEntityTextUrl', 'offset': 332, 'length': 7, 'url': 'https://youtu.be/5AwSbmokQz8'}, {'_': 'MessageEntityBold', 'offset': 332, 'length': 7}, {'_': 'MessageEntityTextUrl', 'offset': 341, 'length': 8, 'url': 'https://rutube.ru/video/5ee7f6f9a8012d868d2e43ecf69c6ba2/'}, {'_': 'MessageEntityBold', 'offset': 341, 'length': 8}, {'_': 'MessageEntityTextUrl', 'offset': 351, 'length': 11, 'url': 'https://vk.com/trader_chernyh?z=video-98605354_456239285%2F2864508e17832f796a%2Fpl_wall_314989763'}, {'_': 'MessageEntityBold', 'offset': 351, 'length': 11}], 'views': 22513, 'forwards': 37, 'replies': {'_': 'MessageReplies', 'replies': 59, 'replies_pts': 97372, 'comments': True, 'recent_repliers': [{'_': 'PeerUser', 'user_id': 610223301}, {'_': 'PeerUser', 'user_id': 627981708}, {'_': 'PeerUser', 'user_id': 7343272497}], 'channel_id': 2293916322, 'max_id': 76730, 'read_max_id': None}, 'edit_date': datetime.datetime(2025, 5, 18, 9, 32, 6, tzinfo=datetime.timezone.utc), 'post_author': None, 'grouped_id': None, 'reactions': {'_': 'MessageReactions', 'results': [{'_': 'ReactionCount', 'reaction': {'_': 'ReactionEmoji', 'emoticon': '👍'}, 'count': 173, 'chosen_order': None}], 'min': False, 'can_see_list': False, 'reactions_as_tags': False, 'recent_reactions': [], 'top_reactors': []}, 'restriction_reason': [], 'ttl_period': None, 'quick_reply_shortcut_id': None, 'effect': None, 'factcheck': None, 'report_delivery_until_date': None, 'paid_message_stars': None}} raw_data_json_len: 5037
[2025-05-18T20:12:00.903+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [WARNING] [Parser] - Не удалось декодировать bytes как UTF-8, будет использовано base64 или плейсхолдер.
[2025-05-18 20:12:00] [WARNING] [Parser] - Не удалось декодировать bytes как UTF-8, будет использовано base64 или плейсхолдер.
[2025-05-18T20:12:00.903+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [WARNING] [Parser] - Не удалось декодировать bytes как UTF-8, будет использовано base64 или плейсхолдер.
[2025-05-18T20:12:00.903+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [WARNING] [Parser] - Не удалось декодировать bytes как UTF-8, будет использовано base64 или плейсхолдер.
[2025-05-18T20:12:00.908+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [WARNING] [Parser] - Не удалось декодировать bytes как UTF-8, будет использовано base64 или плейсхолдер.
[2025-05-18T20:12:00.910+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [WARNING] [Parser] - Не удалось декодировать bytes как UTF-8, будет использовано base64 или плейсхолдер.
[2025-05-18 20:12:00] [WARNING] [Parser] - Не удалось декодировать bytes как UTF-8, будет использовано base64 или плейсхолдер.
[2025-05-18 20:12:00] [WARNING] [Parser] - Не удалось декодировать bytes как UTF-8, будет использовано base64 или плейсхолдер.
[2025-05-18T20:12:00.910+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Данные для вставки (ID: 9669): {'message_id': 9669, 'channel_id': 1137503644, 'message_date': datetime.datetime(2025, 5, 18, 13, 25, 12, tzinfo=datetime.timezone.utc), 'text': 'На бирже у нас сейчас ключевой момент и вот почему:\n\n1️⃣ Технически идет завершение треугольника. И отсюда будет молниеносный выход! **__На принятие решения у Вас осталась одна неделя.__**\n\nГляньте ролик выше ⬆️ \n\n2️⃣ Забавно, что это совпадает с долгожданными переговорами в Стамбуле.  Тот случай, когда техника на графиках рулит политикой.\n\nВот ссылки на обзоры. Срочно смотрим и готовимся! ⬇️\n\n[**➡️ Ютуб**](https://youtu.be/5AwSbmokQz8)\n\n[**➡️ Рутуб**](https://rutube.ru/video/5ee7f6f9a8012d868d2e43ecf69c6ba2/)\n\n[**➡️ ВК.видео**](https://vk.com/trader_chernyh?z=video-98605354_456239285%2F2864508e17832f796a%2Fpl_wall_314989763)\n\n__Забавно, что точно такой же тезис после просмотра моего ролика, растащили себе инфоцыгане. Гопоте на пиво не хватает)__ __Который__ __раз воруют идеи__', 'sender_id': -1001137503644, 'views': 18520, 'forwards': 35, 'is_reply': False, 'reply_to_msg_id': None, 'has_media': True, 'raw_data': {'_': 'Message', 'id': 9669, 'peer_id': {'_': 'PeerChannel', 'channel_id': 1137503644}, 'date': datetime.datetime(2025, 5, 18, 13, 25, 12, tzinfo=datetime.timezone.utc), 'message': 'На бирже у нас сейчас ключевой момент и вот почему:\n\n1️⃣ Технически идет завершение треугольника. И отсюда будет молниеносный выход! На принятие решения у Вас осталась одна неделя.\n\nГляньте ролик выше ⬆️ \n\n2️⃣ Забавно, что это совпадает с долгожданными переговорами в Стамбуле.  Тот случай, когда техника на графиках рулит политикой.\n\nВот ссылки на обзоры. Срочно смотрим и готовимся! ⬇️\n\n➡️ Ютуб\n\n➡️ Рутуб\n\n➡️ ВК.видео\n\nЗабавно, что точно такой же тезис после просмотра моего ролика, растащили себе инфоцыгане. Гопоте на пиво не хватает) Который раз воруют идеи', 'out': False, 'mentioned': False, 'media_unread': False, 'silent': False, 'post': True, 'from_scheduled': False, 'legacy': False, 'edit_hide': False, 'pinned': False, 'noforwards': False, 'invert_media': False, 'offline': False, 'video_processing_pending': False, 'from_id': None, 'from_boosts_applied': None, 'saved_peer_id': None, 'fwd_from': None, 'via_bot_id': None, 'via_business_bot_id': None, 'reply_to': None, 'media': {'_': 'MessageMediaDocument', 'nopremium': False, 'spoiler': False, 'video': True, 'round': False, 'voice': False, 'document': {'_': 'Document', 'id': 5282937828529959578, 'access_hash': -6037802056199033152, 'file_reference': b'\x02C\xcc\xed\x9c\x00\x00%\xc5h*?\x10\xd6\xa2\xfdK\x0f\x91f3\x9e\xc7G\xd5\x97\xcc\xd8\xb8', 'date': datetime.datetime(2025, 5, 18, 14, 2, 7, tzinfo=datetime.timezone.utc), 'mime_type': 'video/mp4', 'size': 1709646, 'dc_id': 2, 'attributes': [{'_': 'DocumentAttributeVideo', 'duration': 11.734, 'w': 848, 'h': 672, 'round_message': False, 'supports_streaming': True, 'nosound': False, 'preload_prefix_size': None, 'video_start_ts': None, 'video_codec': 'h264'}, {'_': 'DocumentAttributeFilename', 'file_name': 'IMG_9078.MP4'}], 'thumbs': [{'_': 'PhotoStrippedSize', 'type': 'i', 'bytes': b"\x01 (\xa1:\xfc\x80\x8ab(\xda\x0e\x06j\xc9\xc6\xdcTx\x03\x8arV\x04\xd0\xccQ\xb4g\xa0\xa9(\x03\x91\x8a\x94\xf5+K\x06\xd1\xe9E;\xa9\xa2\xb5H\xcd\xb0\xb9\x81\x86\xd2\x01'\xbe)\xa8\x8d\xb3\x959\xad\xe3\xe6\xe7\xaf\xea?\xc2\x972\xe7\xae\x07\xae\x7f\xfa\xd5\x9e\xe5\x18^T\x98\xfb\x87\x1fJ|0;H7#c\xe9\x8a\xd9\xcc\xbd7s\xf5\x1f\xe1K\x89\xb1\xd7\xf5\x1f\xe1@\x19om\xf2\xe5T\xabz\x1a+aKta\xf8\xe6\x8ajM\x05\x8f"}, {'_': 'PhotoSize', 'type': 'm', 'w': 320, 'h': 254, 'size': 16729}], 'video_thumbs': []}, 'alt_documents': [{'_': 'Document', 'id': 5282860819766342594, 'access_hash': 8675134366881690538, 'file_reference': b'\x02C\xcc\xed\x9c\x00\x00%\xc5h*?\x10w\x11\xd3\xc0b\xcb\xe3\xa6\xdf\x08(t\x7f\xa3E\x97', 'date': datetime.datetime(2025, 5, 18, 14, 2, 8, tzinfo=datetime.timezone.utc), 'mime_type': 'video/mp4', 'size': 402278, 'dc_id': 2, 'attributes': [{'_': 'DocumentAttributeVideo', 'duration': 11.734, 'w': 604, 'h': 480, 'round_message': False, 'supports_streaming': True, 'nosound': False, 'preload_prefix_size': None, 'video_start_ts': None, 'video_codec': 'av01'}, {'_': 'DocumentAttributeFilename', 'file_name': 'IMG_9078.MP4'}], 'thumbs': [{'_': 'PhotoStrippedSize', 'type': 'i', 'bytes': b'\x01 (\xa1:\xfc\x80\x8ab(\xda\x0e\x06j\xc9\xc6\xdcTx\x03\x8arV\x04\xd0\xccQ\xb4g\xa0\xa9(\x03\x91\x8a\x94\xf5+K\x06\xd1\xe9E;\xa9\xa2\xb5H\xcd\xb0\xb9\x81\x97i\x00\x93\xdf\x14\xd4F\xdb\xca\x9c\xd6\xf1\xf33\xd7\xf5\x1f\xe1Fe\xf5\xc0\xf5\xcf\xff\x00Z\xb3z\x94a\xf9Rc\xee\x1c})\xf0\xc0\xed \xdc\x8d\x8f\xa6+g2\xf4\xdd\xcf\xd4\x7f\x85.&\xc7_\xd4\x7f\x85\x00e\xbd\xb7\xcb\x95R\xad\xe8h\xad\x85-\xd1\x80\xfa\xe6\x8ajM\x05\x8f'}, {'_': 'PhotoSize', 'type': 'm', 'w': 320, 'h': 254, 'size': 16734}], 'video_thumbs': []}, {'_': 'Document', 'id': 5280719413497065918, 'access_hash': -209556573863544952, 'file_reference': b'\x02C\xcc\xed\x9c\x00\x00%\xc5h*?\x10\xba+\xd6Ev {b\xf4\x9aP\xc2\xa12\xbe\xa0', 'date': datetime.datetime(2025, 5, 18, 14, 2, 8, tzinfo=datetime.timezone.utc), 'mime_type': 'application/x-mpegurl', 'size': 391, 'dc_id': 2, 'attributes': [{'_': 'DocumentAttributeFilename', 'file_name': 'mtproto:5282860819766342594'}], 'thumbs': [], 'video_thumbs': []}, {'_': 'Document', 'id': 5283098541911207354, 'access_hash': -2197931620823221123, 'file_reference': b'\x02C\xcc\xed\x9c\x00\x00%\xc5h*?\x10\xc7\x93\x8f\x8030\xa4\x8cH4KK\xe8\x12\xfd-', 'date': datetime.datetime(2025, 5, 18, 14, 2, 8, tzinfo=datetime.timezone.utc), 'mime_type': 'video/mp4', 'size': 463367, 'dc_id': 2, 'attributes': [{'_': 'DocumentAttributeVideo', 'duration': 11.734, 'w': 604, 'h': 480, 'round_message': False, 'supports_streaming': True, 'nosound': False, 'preload_prefix_size': None, 'video_start_ts': None, 'video_codec': 'h264'}, {'_': 'DocumentAttributeFilename', 'file_name': 'IMG_9078.MP4'}], 'thumbs': [{'_': 'PhotoStrippedSize', 'type': 'i', 'bytes': b'\x01 (\xa1:\xfc\x80\x81LE\x1bA\xc0\xcdY8\xdaE3\x00qNJ\xc0\x9a#\xc5\x1bFG\x02\xa4\xa0\x0ex\xa9OR\xb4\xb0m\x1e\x94S\xba\x9a+T\xaef\xd8\\\xc0\xcb\xb4\x80I\xef\x8aj#m\xe5Nk|\xf9\x99\xeb\xfa\x8f\xf0\xa4&\\\xf5\x00}G\xf8VoR\x8c?-\xf1\xf7\x0e>\x94\xf8`f\x90nF\xc7\xd3\x15\xb3\x99\x7f\xbd\xcf\xd4\x7f\x85.&\xc7^~\xa3\xfc(\x03-\xad\xbe\\\xaa\x95oz+aKta\xf8\xe6\x8ai\xb4+\x1f'}, {'_': 'PhotoSize', 'type': 'm', 'w': 320, 'h': 254, 'size': 16983}], 'video_thumbs': []}, {'_': 'Document', 'id': 5282903533216100380, 'access_hash': 5387511471295103330, 'file_reference': b'\x02C\xcc\xed\x9c\x00\x00%\xc5h*?\x10\xc6?\x19\xe7\x13\x8c\xa1\xbe\xeb\x07^B\xc1y:\xcd', 'date': datetime.datetime(2025, 5, 18, 14, 2, 8, tzinfo=datetime.timezone.utc), 'mime_type': 'application/x-mpegurl', 'size': 391, 'dc_id': 2, 'attributes': [{'_': 'DocumentAttributeFilename', 'file_name': 'mtproto:5283098541911207354'}], 'thumbs': [], 'video_thumbs': []}], 'video_cover': None, 'video_timestamp': None, 'ttl_seconds': None}, 'reply_markup': None, 'entities': [{'_': 'MessageEntityBold', 'offset': 133, 'length': 47}, {'_': 'MessageEntityItalic', 'offset': 133, 'length': 47}, {'_': 'MessageEntityTextUrl', 'offset': 389, 'length': 7, 'url': 'https://youtu.be/5AwSbmokQz8'}, {'_': 'MessageEntityBold', 'offset': 389, 'length': 7}, {'_': 'MessageEntityTextUrl', 'offset': 398, 'length': 8, 'url': 'https://rutube.ru/video/5ee7f6f9a8012d868d2e43ecf69c6ba2/'}, {'_': 'MessageEntityBold', 'offset': 398, 'length': 8}, {'_': 'MessageEntityTextUrl', 'offset': 408, 'length': 11, 'url': 'https://vk.com/trader_chernyh?z=video-98605354_456239285%2F2864508e17832f796a%2Fpl_wall_314989763'}, {'_': 'MessageEntityBold', 'offset': 408, 'length': 11}, {'_': 'MessageEntityItalic', 'offset': 421, 'length': 117}, {'_': 'MessageEntityItalic', 'offset': 539, 'length': 7}, {'_': 'MessageEntityItalic', 'offset': 547, 'length': 15}], 'views': 18520, 'forwards': 35, 'replies': {'_': 'MessageReplies', 'replies': 65, 'replies_pts': 97372, 'comments': True, 'recent_repliers': [{'_': 'PeerChannel', 'channel_id': 2293916322}, {'_': 'PeerUser', 'user_id': 1183228255}, {'_': 'PeerUser', 'user_id': 341642106}], 'channel_id': 2293916322, 'max_id': 76724, 'read_max_id': None}, 'edit_date': datetime.datetime(2025, 5, 18, 14, 38, 50, tzinfo=datetime.timezone.utc), 'post_author': None, 'grouped_id': None, 'reactions': {'_': 'MessageReactions', 'results': [{'_': 'ReactionCount', 'reaction': {'_': 'ReactionEmoji', 'emoticon': '👍'}, 'count': 218, 'chosen_order': None}], 'min': False, 'can_see_list': False, 'reactions_as_tags': False, 'recent_reactions': [], 'top_reactors': []}, 'restriction_reason': [], 'ttl_period': None, 'quick_reply_shortcut_id': None, 'effect': None, 'factcheck': None, 'report_delivery_until_date': None, 'paid_message_stars': None}} raw_data_json_len: 8153
[2025-05-18T20:12:00.911+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [INFO] [Parser] - Сохранение в БД завершено. Новых записей: 0, пропущено (ошибки/дубликаты): 2.
[2025-05-18T20:12:00.911+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [INFO] [Parser] - Результаты сохранения в БД: 0 новых, 2 пропущено.
[2025-05-18T20:12:00.911+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [ERROR] [Parser] - Ни одно из полученных сообщений не было сохранено в БД из-за ошибок.
[2025-05-18T20:12:00.913+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [ERROR] [Parser] - Критическая ошибка в main: Критическая ошибка: не удалось сохранить сообщения в БД.
Traceback (most recent call last):
  File "/app/telegram_parser.py", line 507, in main
    raise Exception("Критическая ошибка: не удалось сохранить сообщения в БД.")
Exception: Критическая ошибка: не удалось сохранить сообщения в БД.
[2025-05-18 20:12:00] [INFO] [Parser] - Запись данных XCom в файл: /airflow/xcom/return.json
[2025-05-18T20:12:00.914+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [INFO] [Parser] - Создана директория для XCom: /airflow/xcom
[2025-05-18 20:12:00] [INFO] [Parser] - Данные XCom успешно записаны: {'channel_id': 1137503644, 'target_date_str': '2025-05-18', 'status': 'failure', 'error_type': 'Exception', 'error_message': 'Критическая ошибка: не удалось сохранить сообщения в БД.'}
[2025-05-18 20:12:00] [INFO] [Parser] - Отключение от Telegram...
[2025-05-18T20:12:00.915+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [INFO] [Parser] - Disconnecting from 149.154.167.51:443/TcpFull...
[2025-05-18 20:12:00] [DEBUG] [Parser] - Closing current connection...
[2025-05-18T20:12:00.931+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [DEBUG] [Parser] - Cancelling 0 pending message(s)...
[2025-05-18 20:12:00] [INFO] [Parser] - Disconnection from 149.154.167.51:443/TcpFull complete!
[2025-05-18T20:12:00.938+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [INFO] [Parser] - Соединение с Telegram закрыто.
[2025-05-18 20:12:00] [INFO] [Parser] - Закрытие соединения с БД...
[2025-05-18T20:12:00.938+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [INFO] [Parser] - Соединение с БД закрыто.
[2025-05-18 20:12:00] [INFO] [Parser] - --- Скрипт парсера завершен с кодом выхода: 1 ---
[2025-05-18T20:12:00.938+0000] {docker.py:429} INFO - [2025-05-18 20:12:00] [INFO] [Parser] - Перехвачен SystemExit с кодом 1. Завершение.
[2025-05-18 20:12:00] [INFO] [Parser] - Скрипт парсера окончательно завершается с кодом 1 (из __main__ блока).
[2025-05-18T20:12:00.938+0000] {docker.py:429} INFO - Traceback (most recent call last):
  File "/app/telegram_parser.py", line 586, in <module>
[2025-05-18T20:12:00.939+0000] {docker.py:429} INFO - raise Exception("Задача парсера завершилась с ошибкой, см. логи выше")
Exception: Задача парсера завершилась с ошибкой, см. логи выше
[2025-05-18T20:12:01.280+0000] {taskinstance.py:2698} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/models/taskinstance.py", line 433, in _execute_task
    result = execute_callable(context=context, **execute_callable_kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/docker/operators/docker.py", line 502, in execute
    return self._run_image()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/docker/operators/docker.py", line 376, in _run_image
    return self._run_image_with_mounts(self.mounts, add_tmp_variable=False)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/docker/operators/docker.py", line 437, in _run_image_with_mounts
    raise DockerContainerFailedException(f"Docker container failed: {result!r}", logs=log_lines)
airflow.providers.docker.exceptions.DockerContainerFailedException: Docker container failed: {'StatusCode': 1}
[2025-05-18T20:12:01.285+0000] {taskinstance.py:1138} INFO - Marking task as UP_FOR_RETRY. dag_id=telegram_summary_channel_1137503644, task_id=parse_channel_posts, execution_date=20250518T201156, start_date=20250518T201158, end_date=20250518T201201
[2025-05-18T20:12:01.304+0000] {standard_task_runner.py:107} ERROR - Failed to execute job 56 for task parse_channel_posts (Docker container failed: {'StatusCode': 1}; 204)
[2025-05-18T20:12:01.320+0000] {local_task_job_runner.py:234} INFO - Task exited with return code 1
[2025-05-18T20:12:01.353+0000] {taskinstance.py:3280} INFO - 0 downstream tasks scheduled from follow-on schedule check
